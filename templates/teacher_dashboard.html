{% extends "base.html" %}
{% set active_page = 'teacher' %}
{% block title %}Teacher Dashboard – CertifyMe{% endblock %}

{% block content %}
<div class="mb-4">
  <div class="d-flex flex-wrap justify-content-between align-items-baseline gap-2">
    <div>
      <div class="page-kicker mb-1">Teacher dashboard</div>
      <h1 class="page-title mb-1">
        Welcome, {{ session.teacher_name or "Teacher" }}
      </h1>
      <p class="page-subtitle mb-0">
        Issue new certificates, track what you’ve sent, and open public links in one place.
      </p>
    </div>

    <div class="d-flex flex-wrap gap-2">
      <a href="{{ url_for('upload') }}" class="btn btn-primary-pill btn-pill">
        + Issue new certificate
      </a>
    </div>
  </div>
</div>

<!-- Quick stats -->
<div class="row g-3 mb-4">
  <div class="col-md-4">
    <div class="card-soft h-100 d-flex flex-column justify-content-between">
      <div>
        <div class="small-muted mb-1">Total certificates issued</div>
        <div class="fs-4 fw-semibold">
          {{ uploads|length }}
        </div>
      </div>
      <div class="small-muted mt-2">
        Each certificate is signed and verifiable via a unique code.
      </div>
    </div>
  </div>

  <div class="col-md-4">
    <div class="card-soft h-100 d-flex flex-column justify-content-between">
      <div>
        <div class="small-muted mb-1">Most recent upload</div>
        <div class="fw-semibold">
          {% if uploads %}
            {{ uploads[0]["student_name"] or "Student" }}
          {% else %}
            No certificates yet
          {% endif %}
        </div>
      </div>
      <div class="small-muted mt-2">
        {% if uploads %}
          Uploaded at {{ uploads[0]["uploaded_at"] }}
        {% else %}
          Issue your first certificate to see activity here.
        {% endif %}
      </div>
    </div>
  </div>

  <div class="col-md-4">
    <div class="card-soft h-100 d-flex flex-column justify-content-between">
      <div>
        <div class="small-muted mb-1">Security</div>
        <div class="fw-semibold">
          HMAC-signed files
        </div>
      </div>
      <div class="small-muted mt-2">
        File hashes and signatures are checked on every verification request.
      </div>
    </div>
  </div>
</div>

<!-- Recent certificates table -->
<div class="card-soft">
  <div class="d-flex justify-content-between align-items-center mb-2 flex-wrap gap-2">
    <div>
      <div class="small-muted text-uppercase" style="letter-spacing:0.16em;font-size:0.7rem;">
        Recent certificates
      </div>
      <div class="small-muted">
        Latest certificates you have issued. Click the actions to view or verify.
      </div>
    </div>
    <div class="small-muted">
      Showing {{ uploads|length }} certificate{{ '' if uploads|length == 1 else 's' }}.
    </div>
  </div>

  {% if not uploads %}
    <div class="small-muted mt-2">
      You haven’t issued any certificates yet. Use
      <span class="chip chip--accent">+ Issue new certificate</span>
      above to upload your first one.
    </div>
  {% else %}
    <div class="table-responsive mt-2">
      <table class="table table-modern align-middle">
        <thead>
          <tr>
            <th>Student</th>
            <th>Email</th>
            <th>Description</th>
            <th>Code</th>
            <th>Uploaded</th>
            <th class="text-end">Actions</th>
          </tr>
        </thead>
        <tbody>
          {% for cert in uploads %}
          <tr>
            <td>
              {{ cert["student_name"] or "—" }}
            </td>
            <td class="small-muted">
              {{ cert["student_email"] or "—" }}
            </td>
            <td class="small-muted">
              {{ cert["description"] or "—" }}
            </td>
            <td>
            <span class="chip chip--accent code-chip">
            {{ cert["verification_code"] }}
           </span>
          </td>
            <td class="small-muted">
              {{ cert["uploaded_at"] }}
            </td>
            <td class="text-end">
              <div class="d-inline-flex gap-1 flex-wrap justify-content-end">
                {% if cert["public_token"] %}
                  <a
                    href="{{ url_for('public_view', token=cert['public_token']) }}"
                    class="btn btn-ghost-pill btn-sm"
                    target="_blank"
                    rel="noopener noreferrer"
                  >
                    Public view
                  </a>
                {% endif %}
                <a
                  href="{{ url_for('verify_certificate', code=cert['verification_code']) }}"
                  class="btn btn-primary-pill btn-sm"
                  target="_blank"
                  rel="noopener noreferrer"
                >
                  Verify
                </a>
              </div>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  {% endif %}
</div>
{% endblock %}
